<!DOCTYPE html>
<html>
  <head>
    <title>Check Submission Format</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel='stylesheet' href='vendor/semantic.css' />
    <link rel='stylesheet' href='stylesheets/style.css' />
    <style>
      * {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      pre, code {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace!important;
      }

      span.ok {
        color: green;
      }

      span.err {
        color: red;
      }
    </style>
  </head>
  <body>
  <div class="ui container">
    <div class="ui center aligned">
      <h1 class="ui center aligned header">Assignment 4 Submission Format Checker</h1>

      <h4 class="ui center aligned header">This only checks if your submission file is valid. You MUST manually submit your file to KLMS.</h4>


      <div class="ui grid">
        <div class="nine wide column">
          <div class="ui segment">
            <div class="ui top right attached label">
              Upload
            </div>
            <div action="assignment-4/upload" class="dropzone"  id="dropzone" style="height: 500px;justify-content: center; display: flex; align-items: center; text-align: center;">
            </div>
          </div>
        </div>
        <div class="seven wide column">

          <div class="ui segment">
            <div class="ui top right attached label">
              Result
            </div>
            <div style="height: 500px">
              <table class="ui celled table unstackable" style="height: 100%;">
                <thead>
                <tr>
                  <th>Result
                  </th>
                  <th class="fc" name="result">-
                  </th>
                </tr>
                </thead>
                <tbody>


                <tr>
                  <td>Valid Archive (.tar.gz)</td>
                  <td class="fc" name="targz">-</td>
                </tr>


                <tr>
                  <td>Filename</td>
                  <td class="fc" name="filename">-</td>
                </tr>

                <tr>
                  <td>Student ID</td>
                  <td class="fc" name="sid">-</td>
                </tr>

                <tr>
                  <td>Directory Structure</td>
                  <td class="fc" name="format">-</td>
                </tr>


                <tr>
                  <td><code>readme</code></td>
                  <td class="fc" name="readme">-</td>
                </tr>

                <tr>
                  <td>Ethics Oath</td>
                  <td class="fc" name="oath">-</td>
                </tr>

                  <tr>
                    <td><code>mydc.s</code></td>
                    <td class="fc dyn" name="mydc">-</td>
                  </tr>

                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>


    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
  <script src="vendor/semantic.js"></script>
  <script src="vendor/dropzone.js"></script>
  <script>
    Dropzone.options.dropzone = {
      paramName: "file", // The name that will be used to transfer the file
      maxFilesize: 5, // MB
      parallelUploads: 1,
      uploadMultiple: false,
      autoProcessQueue: true,
      maxFiles: 1,
      addedfile: function(file) {
        $('.fc').text('-');
      },
      success: function (file, resp) {
        this.removeAllFiles();
        try {
          if(resp.success) {

            function mark(param, resp) {
              if(resp[param]) {
                $('.fc[name='+param+']').html("<span class='ok'>Valid</span>");
              } else {
                $('.fc[name='+param+']').html("<span class='err'>Invalid</span>");
                $('.fc[name=result]').html("<span class='err'>Fail</span>");
                return false;
              }
              return true;
            }
            if (!mark('targz', resp)) return;
            if (!mark('filename', resp)) return;
            if(resp.sid)
              $('.fc[name=sid]').text(resp.sid);
            if (!mark('format', resp)) return;
            mark('readme', resp);
            mark('oath', resp);

            $('.fc.dyn').each(function() {
              mark($(this).attr('name'), resp);
            });

            if(!$('.fc[name=result]').find('span.err').length)
              $('.fc[name=result]').html("<span class='ok'>Pass</span>");

          } else {
          }
        } catch (ex) {
          console.error(ex);
        }
      },
      error: function(file, errMsg) {
        alert('Upload Error : ' + errMsg);
        // location.reload();
      },

      dictDefaultMessage: 'Click here or drag your file (.tar.gz) here.',
    };
  </script>
  </body>
</html>
